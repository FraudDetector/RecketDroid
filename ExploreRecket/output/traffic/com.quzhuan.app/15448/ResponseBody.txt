!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(e="undefined"!=typeof globalThis?globalThis:e||self).BiologicalProbeTools=o()}(this,(function(){"use strict";if(Array.prototype.forEach||(Array.prototype.forEach=function(e,o){var t,n;if(null==this)throw new TypeError(" this is null or not defined");var i=Object(this),a=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(t=o),n=0;n<a;){var r;n in i&&(r=i[n],e.call(t,r,n,i)),n++}}),Array.prototype.map||(Array.prototype.map=function(e){var o,t,n;if(null==this)throw new TypeError("this is null or not defined");var i=Object(this),a=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(o=arguments[1]),t=new Array(a),n=0;n<a;){var r,c;n in i&&(r=i[n],c=e.call(o,r,n,i),t[n]=c),n++}return t}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,o){var t=arguments;if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var a=t[i];if(null!=a)for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(n[r]=a[r])}return n},writable:!0,configurable:!0}),!window.Promise){var e=document.createElement("script");e.src="https://yun.tuisnake.com/es6-promise.auto.min.js",(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}var o,t,n,i=function(){var e=window.navigator.userAgent;return{isAndroid:e.indexOf("Android")>-1||e.indexOf("Adr")>-1,isiOS:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)}},a=function(e,o,t){return void 0===t&&(t=.4),new Promise((function(n){var i,a=new Image,r=setTimeout((function(){a.onload=a.onerror=null,r&&clearTimeout(r),n("timeout")}),1e3*t);a.onload=function(){r&&clearTimeout(r),n("success")},a.onerror=function(){r&&clearTimeout(r),n("error")},o._t=Date.now(),i=o,a.src=null==i?e:e+"?"+function(e){if(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")}}(o)}))},r=function(e,o){void 0===o&&(o={ignoreDeviceData:!1});var t=Object.assign(o.ignoreDeviceData?{}:{time:(new Date).getTime(),is_sensor:Number(!!window.DeviceMotionEvent&&i().isAndroid),acceleration:JSON.stringify(window.biologicalProbeToolsData.acceleration.slice(-5)),gravity_acceleration:JSON.stringify(window.biologicalProbeToolsData.gravity_acceleration.slice(-5)),gyroscopes:JSON.stringify(window.biologicalProbeToolsData.gyroscopes.slice(-5))},e),n=t.sendUrl;return delete t.sendUrl,delete t.clickElementFilter,delete t.type,delete t.logName,a(n,Object.assign({type:e.type,logName:e.logName},{json:JSON.stringify(t)}),.8)},c=function(e,o,t){var n=!0,i=!0;return function(){if("function"!=typeof e)throw new TypeError("Expected a function");o=t,a=typeof o,!o||"object"!=a&&"function"!=a||(n="leading"in t?!!t.leading:n,i="trailing"in t?!!t.trailing:i);var o,a}(),function(e,o,t){var n,i,a,r,c,l,s=0,d=!1,u=!1,g=!0,f=Date.now,w=Math.max,m=Math.min;return function(){if("function"!=typeof e)throw new TypeError("Expected a function");var n,i;o=+o||0,i=typeof(n=t),n&&("object"==i||"function"==i)&&(c=(d="maxWait"in t)?w(+t.maxWait||0,o):c,u=!!t.leading,g="trailing"in t?!!t.trailing:g)}(),D.cancel=function(){void 0!==n&&clearTimeout(n),s=0,a=r=i=n=void 0},D.flush=function(){return void 0===n?l:y(f())},D;function p(e){return setTimeout(v,e)}function v(){var e=f();if(b(e))return y(e);var t=function(e){var t=o-(e-r);return d?m(t,c-(e-s)):t}(e);n=p(t)}function b(e){var t=e-r;return void 0===r||t>=o||t<0||d&&e-s>=c}function h(o){var t=a,n=i;return a=i=void 0,s=o,l=e.apply(n,t)}function T(e){return s=e,n=p(o),u?h(e):l}function y(e){return n=void 0,g&&a?h(e):(a=i=void 0,l)}function D(){var e=f(),t=b(e);if(a=arguments,i=this,r=e,t){if(void 0===n)return T(r);if(d)return clearTimeout(n),n=p(o),h(r)}return void 0===n&&(n=p(o)),l}}(e,o,{maxWait:o,leading:n,trailing:i})},l=c((function(e){var t=o.clickElementFilter&&o.clickElementFilter(e.target)||{};r(Object.assign({click_coordinate:"("+e.pageX+", "+e.pageY+")",tag:"1.2"},o,t))}),300),s=c((function(e){try{window.biologicalProbeToolsData.acceleration.push("("+(e.acceleration.x||0)+","+(e.acceleration.y||0)+","+(e.acceleration.z||0)+")"),window.biologicalProbeToolsData.gravity_acceleration.push("("+(e.accelerationIncludingGravity.x||0)+","+(e.accelerationIncludingGravity.y||0)+","+(e.accelerationIncludingGravity.z||0)+")"),window.biologicalProbeToolsData.acceleration.length>20&&(window.biologicalProbeToolsData.acceleration=window.biologicalProbeToolsData.acceleration.slice(-5)),window.biologicalProbeToolsData.gravity_acceleration.length>20&&(window.biologicalProbeToolsData.gravity_acceleration=window.biologicalProbeToolsData.gravity_acceleration.slice(-5))}catch(e){console.error(e)}}),50),d=c((function(e){var o=e.alpha,t=e.beta,n=e.gamma;window.biologicalProbeToolsData.gyroscopes.push("("+o+","+t+","+n+")"),window.biologicalProbeToolsData.gyroscopes.length>20&&(window.biologicalProbeToolsData.gyroscopes=window.biologicalProbeToolsData.gyroscopes.slice(-5))}),50),u=function(e){if(""!==e.id)return'id("'+e.id+'")';if(e===document.body)return e.tagName;for(var o=0,t=e.parentNode.childNodes,n=0;n<t.length;n++){var i=t[n];if(i===e)return u(e.parentNode)+">"+e.tagName+"["+(o+1)+"]";1===i.nodeType&&i.tagName===e.tagName&&o++}},g=function(e){r(Object.assign({tag:"2.4",component_id:u(e.target),component_start_time:window.biologicalProbeToolsData.inputFocusTime,component_end_time:(new Date).getTime()},t))},f=function(e){window.biologicalProbeToolsData.inputFocusTime=(new Date).getTime(),window.biologicalProbeToolsData.inputFocusElement=u(e.target)},w=function(e){window.biologicalProbeToolsData.touchStartTime=(new Date).getTime(),window.biologicalProbeToolsData.touchStartCoordinate=function(e){var o=e.touches&&e.touches[0];return o?"("+o.pageX+", "+o.pageY+")":""}(e)},m=function(e){var o=(new Date).getTime();if(window.biologicalProbeToolsData.touchStartTime>0&&o-window.biologicalProbeToolsData.touchStartTime>=1e3){var t=e.changedTouches&&e.changedTouches[0];r(Object.assign({tag:"1.3",press_start_time:window.biologicalProbeToolsData.touchStartTime,press_start_coordinate:window.biologicalProbeToolsData.touchStartCoordinate,press_end_time:o,press_end_coordinate:t&&"("+t.pageX+","+t.pageY+")"||""},n))}window.biologicalProbeToolsData.touchStartTime=0},p=function(e){try{window.biologicalProbeToolsData.touchStartTime=(new Date).getTime(),window.biologicalProbeToolsData.touchStartCoordinate="("+(e.pageX||0)+", "+(e.pageY||0)+")"}catch(e){console.error(e)}},v=function(e){try{var o=(new Date).getTime();window.biologicalProbeToolsData.touchStartTime>0&&o-window.biologicalProbeToolsData.touchStartTime>=1e3&&r(Object.assign({tag:"1.3",press_start_coordinate:window.biologicalProbeToolsData.touchStartCoordinate,press_end_coordinate:"("+(e.pageX||0)+", "+(e.pageY||0)+")",press_start_time:window.biologicalProbeToolsData.touchStartTime,press_end_time:o},n)),window.biologicalProbeToolsData.touchStartTime=0,window.biologicalProbeToolsData.touchStartCoordinate=""}catch(e){console.error(e)}},b=function(e){r(Object.assign({tag:"3"},e)),document.removeEventListener("click",l),document.removeEventListener("devicemotion",s),document.removeEventListener("deviceorientation",d),document.querySelectorAll("input").forEach((function(e){e.removeEventListener("blur",g),e.removeEventListener("focus",f)})),document.removeEventListener("touchstart",m),document.removeEventListener("touchend",m),document.removeEventListener("pointerdown",p),document.removeEventListener("pointerup",v),document.removeEventListener("pagehide",b)},h=function(e){window.DeviceMotionEvent&&window.addEventListener("devicemotion",s),window.DeviceOrientationEvent&&window.addEventListener("deviceorientation",d),function(e){o=e,document.addEventListener("click",l)}(e),!window.biologicalProbeToolsData.activity_id&&function(e){t=e;try{document.querySelectorAll("input").forEach((function(e){e.addEventListener("focus",f,!0),e.addEventListener("blur",g,!0)}))}catch(e){console.error(e)}}(e),function(e){n=e,document.addEventListener("touchstart",w),document.addEventListener("touchend",m)}(e)};return function(){function e(e){this.baseData={sendLoadTrack:!0,url:window.location.href,sendUrl:"https://openlog.tuia.cn/openlog/collect",type:192,logName:"innerExt02",rid:null,slot_id:null,activity_id:null,tuia_id:null,device_id:null},this.initBiologicalProbeTools(e)}return e.prototype.initBiologicalProbeTools=function(e){Object.assign(this.baseData,e),window.biologicalProbeToolsData={acceleration:[],gravity_acceleration:[],gyroscopes:[],touchTimer:null,touchStartTime:0,touchStartCoordinate:"",inputFocusTime:0,inputFocusElement:"",activity_id:e.activity_id||""}},e.prototype.startEventListen=function(){var e,o,t=this.baseData.sendLoadTrack;delete this.baseData.sendLoadTrack,t&&(e=this.baseData,o=function(){setTimeout((function(){var o=(new Date).getTime(),t=0;window.performance.getEntriesByType?performance.getEntriesByType("navigation").forEach((function(e){t=e.loadEventEnd})):(o=window.performance.timing.loadEventEnd,t=window.performance.timing.loadEventEnd-window.performance.timing.navigationStart),r(Object.assign({tag:"1.1",time:o,loadEventEnd:t.toString().slice(0,10)},e))}),0)},"complete"===document.readyState?o():document.addEventListener("readystatechange",(function(){"complete"===document.readyState&&o()}))),t&&function(e){window.addEventListener("pagehide",(function(){b(e)}))}(this.baseData),i().isAndroid&&h(this.baseData)},e.prototype.sendBiologicalProbeTrace=function(e){void 0===e&&(e={}),r(Object.assign({},this.baseData,e))},e}()}));
